<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Config 3.0/EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.frogs.matzip.rest.RestMapper">
	<insert id="insRest" parameterType="RestVO" useGeneratedKeys="true"  keyProperty="i_rest">
		INSERT INTO t_rest
		(nm, addr, lat, lng, i_category, phone, price_range, open_time, close_time, ctnt, i_district)
		VALUES
		(#{nm}, #{addr}, #{lat}, #{lng}, #{i_category}, #{phone}, #{price_range}, #{open_time}, #{close_time}, #{ctnt}, #{i_district})
	</insert>
	
	<insert id="insFoodMenu" parameterType="RestRecMenuVO">
		INSERT INTO t_rest_pic 
		(i_rest, seq, food_pic)
		SELECT #{i_rest}, ifnull(max(seq), 0) + 1, #{food_pic}
		FROM t_rest_pic
	</insert>
	
	<select id="selRest" parameterType="RestPARAM" resultType="RestDMI">
		SELECT i_rest, nm, addr, lat, lng, i_category, menu_pic, hit, r_dt, m_dt, phone, price_range, open_time, close_time, ctnt, i_district
		FROM t_rest
		<if test="i_rest > 0">
			WHERE i_rest = #{i_rest}
		</if>
	</select>
	
	<select id="selRecRestList" resultType="RestDMI">
		SELECT * FROM t_rest
	</select>
	
	<select id="selCategoryList" resultType="RestDMI">
		SELECT i_category, val as category_val FROM t_category
	</select>
	
	<select id="selDistrictList" resultType="RestDMI">
		SELECT i_district, val as district_val FROM t_district
	</select>
	
	<select id="selRestList" parameterType="RestPARAM" resultType="RestDMI">
	 	SELECT i_rest, nm, addr, lat, lng, i_category, i_district
	 	FROM t_rest
	 	<if test="search_text != null">
	 		WHERE nm like #{search_text_sql} or addr like #{search_text_sql}
	 	</if>
	 	ORDER BY i_rest
	</select>
	
	<select id ="selFoodmenu" parameterType="RestPARAM" resultType="RestRecMenuVO">
		SELECT i_rest, seq, food_pic
		FROM t_rest_pic
	</select>
	
	<update id="updRestMenu" parameterType="RestVO">
		UPDATE t_rest SET menu_pic = #{menu_pic}
		WHERE i_rest = #{i_rest}
	</update>
</mapper>